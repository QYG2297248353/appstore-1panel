version: "3.8"

x-logging: &x-logging
  logging:
    driver: 'json-file'
    options:
      max-file: '5'
      max-size: '10m'

networks:
  gateway:
    name: gateway
  appwrite:
    name: appwrite
  runtimes:
    name: runtimes

services:
  traefik:
    image: traefik:2.11
    labels:
      createdBy: "Apps"
    restart: always
    <<: *x-logging
    command:
      - --providers.file.directory=/storage/config
      - --providers.file.watch=true
      - --providers.docker=true
      - --providers.docker.exposedByDefault=false
      - --providers.docker.constraints=Label(`traefik.constraint-label-stack`,`appwrite`)
      - --entrypoints.appwrite_web.address=:80
      - --entrypoints.appwrite_websecure.address=:443
    ports:
      - ${PANEL_APP_PORT_HTTP}:80
      - ${PANEL_APP_PORT_HTTPS}:443
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ${APPWRITE_ROOT_PATH}/storage/config:/storage/config:ro
      - ${APPWRITE_ROOT_PATH}/storage/certificates:/storage/certificates:ro
    depends_on:
      - appwrite
    networks:
      - gateway
      - appwrite

  appwrite:
    image: appwrite/appwrite:1.5.4
    container_name: ${CONTAINER_NAME}
    restart: always
    <<: *x-logging
    networks:
      - appwrite
    labels:
      - createdBy=Apps
      - traefik.enable=true
      - traefik.constraint-label-stack=appwrite
      - traefik.docker.network=appwrite
      - traefik.http.services.appwrite_api.loadbalancer.server.port=80
      #http
      - traefik.http.routers.appwrite_api_http.entrypoints=appwrite_web
      - traefik.http.routers.appwrite_api_http.rule=PathPrefix(`/`)
      - traefik.http.routers.appwrite_api_http.service=appwrite_api
      # https
      - traefik.http.routers.appwrite_api_https.entrypoints=appwrite_websecure
      - traefik.http.routers.appwrite_api_https.rule=PathPrefix(`/`)
      - traefik.http.routers.appwrite_api_https.service=appwrite_api
      - traefik.http.routers.appwrite_api_https.tls=true
    volumes:
      - ${APPWRITE_ROOT_PATH}/storage/uploads:/storage/uploads:rw
      - ${APPWRITE_ROOT_PATH}/storage/cache:/storage/cache:rw
      - ${APPWRITE_ROOT_PATH}/storage/config:/storage/config:rw
      - ${APPWRITE_ROOT_PATH}/storage/certificates:/storage/certificates:rw
      - ${APPWRITE_ROOT_PATH}/storage/functions:/storage/functions:rw
    depends_on:
      - appwrite-mariadb
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_LOCALE=${_APP_LOCALE:-en}
      - _APP_CONSOLE_WHITELIST_ROOT=${_APP_CONSOLE_WHITELIST_ROOT:-enabled}
      - _APP_CONSOLE_WHITELIST_EMAILS
      - _APP_CONSOLE_WHITELIST_IPS
      - _APP_CONSOLE_HOSTNAMES
      - _APP_SYSTEM_EMAIL_NAME=${_APP_SYSTEM_EMAIL_NAME:-Appwrite}
      - _APP_SYSTEM_EMAIL_ADDRESS=${_APP_SYSTEM_EMAIL_ADDRESS:-team@appwrite.io}
      - _APP_SYSTEM_SECURITY_EMAIL_ADDRESS=${_APP_SYSTEM_SECURITY_EMAIL_ADDRESS:-certs@appwrite.io}
      - _APP_SYSTEM_RESPONSE_FORMAT
      - _APP_OPTIONS_ABUSE=${_APP_OPTIONS_ABUSE:-enabled}
      - _APP_OPTIONS_ROUTER_PROTECTION=${_APP_OPTIONS_ROUTER_PROTECTION:-disabled}
      - _APP_OPTIONS_FORCE_HTTPS=${_APP_OPTIONS_FORCE_HTTPS:-disabled}
      - _APP_OPTIONS_FUNCTIONS_FORCE_HTTPS=${_APP_OPTIONS_FUNCTIONS_FORCE_HTTPS:-disabled}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_DOMAIN=${_APP_DOMAIN:-localhost}
      - _APP_DOMAIN_TARGET=${_APP_DOMAIN_TARGET:-localhost}
      - _APP_DOMAIN_FUNCTIONS=${_APP_DOMAIN_FUNCTIONS}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_SMTP_HOST=${_APP_SMTP_HOST}
      - _APP_SMTP_PORT=${_APP_SMTP_PORT}
      - _APP_SMTP_SECURE=${_APP_SMTP_SECURE}
      - _APP_SMTP_USERNAME=${_APP_SMTP_USERNAME}
      - _APP_SMTP_PASSWORD=${_APP_SMTP_PASSWORD}
      - _APP_USAGE_STATS=${_APP_USAGE_STATS:-enabled}
      - _APP_STORAGE_LIMIT=${_APP_STORAGE_LIMIT:-30000000}
      - _APP_STORAGE_PREVIEW_LIMIT=${_APP_STORAGE_PREVIEW_LIMIT:-20000000}
      - _APP_STORAGE_ANTIVIRUS=${_APP_STORAGE_ANTIVIRUS:-disabled}
      - _APP_STORAGE_ANTIVIRUS_HOST=${_APP_STORAGE_ANTIVIRUS_HOST:-clamav}
      - _APP_STORAGE_ANTIVIRUS_PORT=${_APP_STORAGE_ANTIVIRUS_PORT:-3310}
      - _APP_STORAGE_DEVICE=${_APP_STORAGE_DEVICE:-local}
      - _APP_STORAGE_S3_ACCESS_KEY=${_APP_STORAGE_S3_ACCESS_KEY}
      - _APP_STORAGE_S3_SECRET=${_APP_STORAGE_S3_SECRET}
      - _APP_STORAGE_S3_REGION=${_APP_STORAGE_S3_REGION}
      - _APP_STORAGE_S3_BUCKET=${_APP_STORAGE_S3_BUCKET}
      - _APP_STORAGE_DO_SPACES_ACCESS_KEY=${_APP_STORAGE_DO_SPACES_ACCESS_KEY}
      - _APP_STORAGE_DO_SPACES_SECRET=${_APP_STORAGE_DO_SPACES_SECRET}
      - _APP_STORAGE_DO_SPACES_REGION=${_APP_STORAGE_DO_SPACES_REGION}
      - _APP_STORAGE_DO_SPACES_BUCKET=${_APP_STORAGE_DO_SPACES_BUCKET}
      - _APP_STORAGE_BACKBLAZE_ACCESS_KEY=${_APP_STORAGE_BACKBLAZE_ACCESS_KEY}
      - _APP_STORAGE_BACKBLAZE_SECRET=${_APP_STORAGE_BACKBLAZE_SECRET}
      - _APP_STORAGE_BACKBLAZE_REGION=${_APP_STORAGE_BACKBLAZE_REGION}
      - _APP_STORAGE_BACKBLAZE_BUCKET=${_APP_STORAGE_BACKBLAZE_BUCKET}
      - _APP_STORAGE_LINODE_ACCESS_KEY=${_APP_STORAGE_LINODE_ACCESS_KEY}
      - _APP_STORAGE_LINODE_SECRET=${_APP_STORAGE_LINODE_SECRET}
      - _APP_STORAGE_LINODE_REGION=${_APP_STORAGE_LINODE_REGION}
      - _APP_STORAGE_LINODE_BUCKET=${_APP_STORAGE_LINODE_BUCKET}
      - _APP_STORAGE_WASABI_ACCESS_KEY=${_APP_STORAGE_WASABI_ACCESS_KEY}
      - _APP_STORAGE_WASABI_SECRET=${_APP_STORAGE_WASABI_SECRET}
      - _APP_STORAGE_WASABI_REGION=${_APP_STORAGE_WASABI_REGION}
      - _APP_STORAGE_WASABI_BUCKET=${_APP_STORAGE_WASABI_BUCKET}
      - _APP_FUNCTIONS_SIZE_LIMIT=${_APP_FUNCTIONS_SIZE_LIMIT:-30000000}
      - _APP_FUNCTIONS_TIMEOUT=${_APP_FUNCTIONS_TIMEOUT:-900}
      - _APP_FUNCTIONS_BUILD_TIMEOUT=${_APP_FUNCTIONS_BUILD_TIMEOUT:-900}
      - _APP_FUNCTIONS_CPUS=${_APP_FUNCTIONS_CPUS:-0}
      - _APP_FUNCTIONS_MEMORY=${_APP_FUNCTIONS_MEMORY:-0}
      - _APP_FUNCTIONS_RUNTIMES=${_APP_FUNCTIONS_RUNTIMES:-node-16.0,php-8.0,python-3.9,ruby-3.0}
      - _APP_EXECUTOR_SECRET=${_APP_EXECUTOR_SECRET}
      - _APP_EXECUTOR_HOST=${_APP_EXECUTOR_HOST:-http://appwrite-executor/v1}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_MAINTENANCE_INTERVAL=${_APP_MAINTENANCE_INTERVAL:-86400}
      - _APP_MAINTENANCE_DELAY
      - _APP_MAINTENANCE_RETENTION_EXECUTION=${_APP_MAINTENANCE_RETENTION_EXECUTION:-1209600}
      - _APP_MAINTENANCE_RETENTION_CACHE=${_APP_MAINTENANCE_RETENTION_CACHE:-2592000}
      - _APP_MAINTENANCE_RETENTION_ABUSE=${_APP_MAINTENANCE_RETENTION_ABUSE:-86400}
      - _APP_MAINTENANCE_RETENTION_AUDIT=${_APP_MAINTENANCE_RETENTION_AUDIT:-1209600}
      - _APP_MAINTENANCE_RETENTION_USAGE_HOURLY=${_APP_MAINTENANCE_RETENTION_USAGE_HOURLY:-8640000}
      - _APP_MAINTENANCE_RETENTION_SCHEDULES=${_APP_MAINTENANCE_RETENTION_SCHEDULES:-86400}
      - _APP_SMS_PROVIDER
      - _APP_SMS_FROM
      - _APP_GRAPHQL_MAX_BATCH_SIZE=${_APP_GRAPHQL_MAX_BATCH_SIZE:-10}
      - _APP_GRAPHQL_MAX_COMPLEXITY=${_APP_GRAPHQL_MAX_COMPLEXITY:-250}
      - _APP_GRAPHQL_MAX_DEPTH=${_APP_GRAPHQL_MAX_DEPTH:-3}
      - _APP_VCS_GITHUB_APP_NAME=${_APP_VCS_GITHUB_APP_NAME}
      - _APP_VCS_GITHUB_PRIVATE_KEY=${_APP_VCS_GITHUB_PRIVATE_KEY}
      - _APP_VCS_GITHUB_APP_ID=${_APP_VCS_GITHUB_APP_ID}
      - _APP_VCS_GITHUB_WEBHOOK_SECRET=${_APP_VCS_GITHUB_WEBHOOK_SECRET}
      - _APP_VCS_GITHUB_CLIENT_SECRET=${_APP_VCS_GITHUB_CLIENT_SECRET}
      - _APP_VCS_GITHUB_CLIENT_ID=${_APP_VCS_GITHUB_CLIENT_ID}
      - _APP_MIGRATIONS_FIREBASE_CLIENT_ID=${_APP_MIGRATIONS_FIREBASE_CLIENT_ID}
      - _APP_MIGRATIONS_FIREBASE_CLIENT_SECRET=${_APP_MIGRATIONS_FIREBASE_CLIENT_SECRET}
      - _APP_ASSISTANT_OPENAI_API_KEY=${_APP_ASSISTANT_OPENAI_API_KEY}

  appwrite-realtime:
    image: appwrite/appwrite:1.5.4
    restart: always
    entrypoint: realtime
    <<: *x-logging
    labels:
      - "createdBy=Apps"
      - "traefik.enable=true"
      - "traefik.constraint-label-stack=appwrite"
      - "traefik.docker.network=appwrite"
      - "traefik.http.services.appwrite_realtime.loadbalancer.server.port=80"
      #ws
      - traefik.http.routers.appwrite_realtime_ws.entrypoints=appwrite_web
      - traefik.http.routers.appwrite_realtime_ws.rule=PathPrefix(`/v1/realtime`)
      - traefik.http.routers.appwrite_realtime_ws.service=appwrite_realtime
      # wss
      - traefik.http.routers.appwrite_realtime_wss.entrypoints=appwrite_websecure
      - traefik.http.routers.appwrite_realtime_wss.rule=PathPrefix(`/v1/realtime`)
      - traefik.http.routers.appwrite_realtime_wss.service=appwrite_realtime
      - traefik.http.routers.appwrite_realtime_wss.tls=true
    networks:
      - appwrite
    depends_on:
      - appwrite-mariadb
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPTIONS_ABUSE=${_APP_OPTIONS_ABUSE:-enabled}
      - _APP_OPTIONS_ROUTER_PROTECTION=${_APP_OPTIONS_ROUTER_PROTECTION:-disabled}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_USAGE_STATS=${_APP_USAGE_STATS:-enabled}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG

  appwrite-worker-audits:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-audits
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG

  appwrite-worker-webhooks:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-webhooks
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_SYSTEM_SECURITY_EMAIL_ADDRESS=${_APP_SYSTEM_SECURITY_EMAIL_ADDRESS:-certs@appwrite.io}
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG

  appwrite-worker-deletes:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-deletes
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    volumes:
      - ${APPWRITE_ROOT_PATH}/storage/uploads:/storage/uploads:rw
      - ${APPWRITE_ROOT_PATH}/storage/cache:/storage/cache:rw
      - ${APPWRITE_ROOT_PATH}/storage/functions:/storage/functions:rw
      - ${APPWRITE_ROOT_PATH}/storage/builds:/storage/builds:rw
      - ${APPWRITE_ROOT_PATH}/storage/certificates:/storage/certificates:rw
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_STORAGE_DEVICE=${_APP_STORAGE_DEVICE:-local}
      - _APP_STORAGE_S3_ACCESS_KEY=${_APP_STORAGE_S3_ACCESS_KEY}
      - _APP_STORAGE_S3_SECRET=${_APP_STORAGE_S3_SECRET}
      - _APP_STORAGE_S3_REGION=${_APP_STORAGE_S3_REGION}
      - _APP_STORAGE_S3_BUCKET=${_APP_STORAGE_S3_BUCKET}
      - _APP_STORAGE_DO_SPACES_ACCESS_KEY=${_APP_STORAGE_DO_SPACES_ACCESS_KEY}
      - _APP_STORAGE_DO_SPACES_SECRET=${_APP_STORAGE_DO_SPACES_SECRET}
      - _APP_STORAGE_DO_SPACES_REGION=${_APP_STORAGE_DO_SPACES_REGION}
      - _APP_STORAGE_DO_SPACES_BUCKET=${_APP_STORAGE_DO_SPACES_BUCKET}
      - _APP_STORAGE_BACKBLAZE_ACCESS_KEY=${_APP_STORAGE_BACKBLAZE_ACCESS_KEY}
      - _APP_STORAGE_BACKBLAZE_SECRET=${_APP_STORAGE_BACKBLAZE_SECRET}
      - _APP_STORAGE_BACKBLAZE_REGION=${_APP_STORAGE_BACKBLAZE_REGION}
      - _APP_STORAGE_BACKBLAZE_BUCKET=${_APP_STORAGE_BACKBLAZE_BUCKET}
      - _APP_STORAGE_LINODE_ACCESS_KEY=${_APP_STORAGE_LINODE_ACCESS_KEY}
      - _APP_STORAGE_LINODE_SECRET=${_APP_STORAGE_LINODE_SECRET}
      - _APP_STORAGE_LINODE_REGION=${_APP_STORAGE_LINODE_REGION}
      - _APP_STORAGE_LINODE_BUCKET=${_APP_STORAGE_LINODE_BUCKET}
      - _APP_STORAGE_WASABI_ACCESS_KEY=${_APP_STORAGE_WASABI_ACCESS_KEY}
      - _APP_STORAGE_WASABI_SECRET=${_APP_STORAGE_WASABI_SECRET}
      - _APP_STORAGE_WASABI_REGION=${_APP_STORAGE_WASABI_REGION}
      - _APP_STORAGE_WASABI_BUCKET=${_APP_STORAGE_WASABI_BUCKET}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_EXECUTOR_SECRET=${_APP_EXECUTOR_SECRET}
      - _APP_EXECUTOR_HOST=${_APP_EXECUTOR_HOST:-http://appwrite-executor/v1}

  appwrite-worker-databases:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-databases
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG

  appwrite-worker-builds:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-builds
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    volumes:
      - ${APPWRITE_ROOT_PATH}/storage/functions:/storage/functions:rw
      - ${APPWRITE_ROOT_PATH}/storage/builds:/storage/builds:rw
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_EXECUTOR_SECRET=${_APP_EXECUTOR_SECRET}
      - _APP_EXECUTOR_HOST=${_APP_EXECUTOR_HOST:-http://appwrite-executor/v1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_VCS_GITHUB_APP_NAME=${_APP_VCS_GITHUB_APP_NAME}
      - _APP_VCS_GITHUB_PRIVATE_KEY=${_APP_VCS_GITHUB_PRIVATE_KEY}
      - _APP_VCS_GITHUB_APP_ID=${_APP_VCS_GITHUB_APP_ID}
      - _APP_FUNCTIONS_TIMEOUT=${_APP_FUNCTIONS_TIMEOUT:-900}
      - _APP_FUNCTIONS_BUILD_TIMEOUT=${_APP_FUNCTIONS_BUILD_TIMEOUT:-900}
      - _APP_FUNCTIONS_CPUS=${_APP_FUNCTIONS_CPUS:-0}
      - _APP_FUNCTIONS_MEMORY=${_APP_FUNCTIONS_MEMORY:-0}
      - _APP_FUNCTIONS_SIZE_LIMIT=${_APP_FUNCTIONS_SIZE_LIMIT:-30000000}
      - _APP_OPTIONS_FORCE_HTTPS=${_APP_OPTIONS_FORCE_HTTPS:-disabled}
      - _APP_OPTIONS_FUNCTIONS_FORCE_HTTPS=${_APP_OPTIONS_FUNCTIONS_FORCE_HTTPS:-disabled}
      - _APP_DOMAIN=${_APP_DOMAIN:-localhost}
      - _APP_STORAGE_DEVICE=${_APP_STORAGE_DEVICE:-local}
      - _APP_STORAGE_S3_ACCESS_KEY=${_APP_STORAGE_S3_ACCESS_KEY}
      - _APP_STORAGE_S3_SECRET=${_APP_STORAGE_S3_SECRET}
      - _APP_STORAGE_S3_REGION=${_APP_STORAGE_S3_REGION}
      - _APP_STORAGE_S3_BUCKET=${_APP_STORAGE_S3_BUCKET}
      - _APP_STORAGE_DO_SPACES_ACCESS_KEY=${_APP_STORAGE_DO_SPACES_ACCESS_KEY}
      - _APP_STORAGE_DO_SPACES_SECRET=${_APP_STORAGE_DO_SPACES_SECRET}
      - _APP_STORAGE_DO_SPACES_REGION=${_APP_STORAGE_DO_SPACES_REGION}
      - _APP_STORAGE_DO_SPACES_BUCKET=${_APP_STORAGE_DO_SPACES_BUCKET}
      - _APP_STORAGE_BACKBLAZE_ACCESS_KEY=${_APP_STORAGE_BACKBLAZE_ACCESS_KEY}
      - _APP_STORAGE_BACKBLAZE_SECRET=${_APP_STORAGE_BACKBLAZE_SECRET}
      - _APP_STORAGE_BACKBLAZE_REGION=${_APP_STORAGE_BACKBLAZE_REGION}
      - _APP_STORAGE_BACKBLAZE_BUCKET=${_APP_STORAGE_BACKBLAZE_BUCKET}
      - _APP_STORAGE_LINODE_ACCESS_KEY=${_APP_STORAGE_LINODE_ACCESS_KEY}
      - _APP_STORAGE_LINODE_SECRET=${_APP_STORAGE_LINODE_SECRET}
      - _APP_STORAGE_LINODE_REGION=${_APP_STORAGE_LINODE_REGION}
      - _APP_STORAGE_LINODE_BUCKET=${_APP_STORAGE_LINODE_BUCKET}
      - _APP_STORAGE_WASABI_ACCESS_KEY=${_APP_STORAGE_WASABI_ACCESS_KEY}
      - _APP_STORAGE_WASABI_SECRET=${_APP_STORAGE_WASABI_SECRET}
      - _APP_STORAGE_WASABI_REGION=${_APP_STORAGE_WASABI_REGION}
      - _APP_STORAGE_WASABI_BUCKET=${_APP_STORAGE_WASABI_BUCKET}

  appwrite-worker-certificates:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-certificates
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    volumes:
      - ${APPWRITE_ROOT_PATH}/storage/config:/storage/config:rw
      - ${APPWRITE_ROOT_PATH}/storage/certificates:/storage/certificates:rw
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_DOMAIN=${_APP_DOMAIN:-localhost}
      - _APP_DOMAIN_TARGET=${_APP_DOMAIN_TARGET:-localhost}
      - _APP_DOMAIN_FUNCTIONS=${_APP_DOMAIN_FUNCTIONS}
      - _APP_SYSTEM_SECURITY_EMAIL_ADDRESS=${_APP_SYSTEM_SECURITY_EMAIL_ADDRESS:-certs@appwrite.io}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG

  appwrite-worker-functions:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-functions
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
      - openruntimes-executor
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_FUNCTIONS_TIMEOUT=${_APP_FUNCTIONS_TIMEOUT:-900}
      - _APP_FUNCTIONS_BUILD_TIMEOUT=${_APP_FUNCTIONS_BUILD_TIMEOUT:-900}
      - _APP_FUNCTIONS_CPUS=${_APP_FUNCTIONS_CPUS:-0}
      - _APP_FUNCTIONS_MEMORY=${_APP_FUNCTIONS_MEMORY:-0}
      - _APP_EXECUTOR_SECRET=${_APP_EXECUTOR_SECRET}
      - _APP_EXECUTOR_HOST=${_APP_EXECUTOR_HOST:-http://appwrite-executor/v1}
      - _APP_USAGE_STATS=${_APP_USAGE_STATS:-enabled}
      - _APP_DOCKER_HUB_USERNAME=${_APP_DOCKER_HUB_USERNAME}
      - _APP_DOCKER_HUB_PASSWORD=${_APP_DOCKER_HUB_PASSWORD}
      - _APP_LOGGING_CONFIG
      - _APP_LOGGING_PROVIDER

  appwrite-worker-mails:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-mails
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_SYSTEM_EMAIL_NAME=${_APP_SYSTEM_EMAIL_NAME:-Appwrite}
      - _APP_SYSTEM_EMAIL_ADDRESS=${_APP_SYSTEM_EMAIL_ADDRESS:-team@appwrite.io}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_SMTP_HOST=${_APP_SMTP_HOST}
      - _APP_SMTP_PORT=${_APP_SMTP_PORT}
      - _APP_SMTP_SECURE=${_APP_SMTP_SECURE}
      - _APP_SMTP_USERNAME=${_APP_SMTP_USERNAME}
      - _APP_SMTP_PASSWORD=${_APP_SMTP_PASSWORD}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG

  appwrite-worker-messaging:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-messaging
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_SMS_FROM
      - _APP_SMS_PROVIDER

  appwrite-worker-migrations:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-migrations
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-mariadb
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_DOMAIN=${_APP_DOMAIN:-localhost}
      - _APP_DOMAIN_TARGET=${_APP_DOMAIN_TARGET:-localhost}
      - _APP_SYSTEM_SECURITY_EMAIL_ADDRESS=${_APP_SYSTEM_SECURITY_EMAIL_ADDRESS:-certs@appwrite.io}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_MIGRATIONS_FIREBASE_CLIENT_ID=${_APP_MIGRATIONS_FIREBASE_CLIENT_ID}
      - _APP_MIGRATIONS_FIREBASE_CLIENT_SECRET=${_APP_MIGRATIONS_FIREBASE_CLIENT_SECRET}

  appwrite-maintenance:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: maintenance
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_DOMAIN=${_APP_DOMAIN:-localhost}
      - _APP_DOMAIN_TARGET=${_APP_DOMAIN_TARGET:-localhost}
      - _APP_DOMAIN_FUNCTIONS=${_APP_DOMAIN_FUNCTIONS}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_MAINTENANCE_INTERVAL=${_APP_MAINTENANCE_INTERVAL:-86400}
      - _APP_MAINTENANCE_RETENTION_EXECUTION=${_APP_MAINTENANCE_RETENTION_EXECUTION:-1209600}
      - _APP_MAINTENANCE_RETENTION_CACHE=${_APP_MAINTENANCE_RETENTION_CACHE:-2592000}
      - _APP_MAINTENANCE_RETENTION_ABUSE=${_APP_MAINTENANCE_RETENTION_ABUSE:-86400}
      - _APP_MAINTENANCE_RETENTION_AUDIT=${_APP_MAINTENANCE_RETENTION_AUDIT:-1209600}
      - _APP_MAINTENANCE_RETENTION_USAGE_HOURLY=${_APP_MAINTENANCE_RETENTION_USAGE_HOURLY:-8640000}
      - _APP_MAINTENANCE_RETENTION_SCHEDULES=${_APP_MAINTENANCE_RETENTION_SCHEDULES:-86400}

  appwrite-worker-usage:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: worker-usage
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_USAGE_STATS=${_APP_USAGE_STATS:-enabled}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_USAGE_AGGREGATION_INTERVAL=${_APP_USAGE_AGGREGATION_INTERVAL:-30}

  appwrite-worker-usage-dump:
    image: appwrite/appwrite:1.5.4
    entrypoint: worker-usage-dump
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-redis
      - appwrite-mariadb
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_USAGE_STATS=${_APP_USAGE_STATS:-enabled}
      - _APP_LOGGING_PROVIDER
      - _APP_LOGGING_CONFIG
      - _APP_USAGE_AGGREGATION_INTERVAL=${_APP_USAGE_AGGREGATION_INTERVAL:-30}

  appwrite-scheduler-functions:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: schedule-functions
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-mariadb
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}

  appwrite-scheduler-messages:
    image: appwrite/appwrite:1.5.4
    labels:
      createdBy: "Apps"
    restart: always
    entrypoint: schedule-messages
    <<: *x-logging
    networks:
      - appwrite
    depends_on:
      - appwrite-mariadb
      - appwrite-redis
    environment:
      - _APP_ENV=${_APP_ENV:-production}
      - _APP_WORKER_PER_CORE=${_APP_WORKER_PER_CORE:-6}
      - _APP_OPENSSL_KEY_V1=${_APP_OPENSSL_KEY_V1}
      - _APP_REDIS_HOST=${_APP_REDIS_HOST:-appwrite-redis}
      - _APP_REDIS_PORT=${_APP_REDIS_PORT:-6379}
      - _APP_REDIS_USER
      - _APP_REDIS_PASS
      - _APP_DB_HOST=${_APP_DB_HOST:-appwrite-mariadb}
      - _APP_DB_PORT=${_APP_DB_PORT:-3306}
      - _APP_DB_SCHEMA=${_APP_DB_SCHEMA:-appwrite}
      - _APP_DB_USER=${_APP_DB_USER:-user}
      - _APP_DB_PASS=${_APP_DB_PASS:-password}

  appwrite-assistant:
    image: appwrite/assistant:0.4.0
    labels:
      createdBy: "Apps"
    restart: always
    <<: *x-logging
    networks:
      - appwrite
    environment:
      - _APP_ASSISTANT_OPENAI_API_KEY=${_APP_ASSISTANT_OPENAI_API_KEY}

  openruntimes-executor:
    hostname: appwrite-executor
    labels:
      createdBy: "Apps"
    restart: always
    <<: *x-logging
    stop_signal: SIGINT
    image: openruntimes/executor:0.4.12
    networks:
      - appwrite
      - runtimes
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /tmp:/tmp:rw
      - ${APPWRITE_ROOT_PATH}/storage/builds:/storage/builds:rw
      - ${APPWRITE_ROOT_PATH}/storage/functions:/storage/functions:rw
    environment:
      - OPR_EXECUTOR_INACTIVE_TRESHOLD=$_APP_FUNCTIONS_INACTIVE_THRESHOLD
      - OPR_EXECUTOR_MAINTENANCE_INTERVAL=$_APP_FUNCTIONS_MAINTENANCE_INTERVAL
      - OPR_EXECUTOR_NETWORK=$_APP_FUNCTIONS_RUNTIMES_NETWORK
      - OPR_EXECUTOR_DOCKER_HUB_USERNAME=$_APP_DOCKER_HUB_USERNAME
      - OPR_EXECUTOR_DOCKER_HUB_PASSWORD=$_APP_DOCKER_HUB_PASSWORD
      - OPR_EXECUTOR_ENV=$_APP_ENV
      - OPR_EXECUTOR_RUNTIMES=$_APP_FUNCTIONS_RUNTIMES
      - OPR_EXECUTOR_SECRET=$_APP_EXECUTOR_SECRET
      - OPR_EXECUTOR_LOGGING_PROVIDER=$_APP_LOGGING_PROVIDER
      - OPR_EXECUTOR_LOGGING_CONFIG=$_APP_LOGGING_CONFIG
      - OPR_EXECUTOR_STORAGE_DEVICE=$_APP_STORAGE_DEVICE
      - OPR_EXECUTOR_STORAGE_S3_ACCESS_KEY=$_APP_STORAGE_S3_ACCESS_KEY
      - OPR_EXECUTOR_STORAGE_S3_SECRET=$_APP_STORAGE_S3_SECRET
      - OPR_EXECUTOR_STORAGE_S3_REGION=$_APP_STORAGE_S3_REGION
      - OPR_EXECUTOR_STORAGE_S3_BUCKET=$_APP_STORAGE_S3_BUCKET
      - OPR_EXECUTOR_STORAGE_DO_SPACES_ACCESS_KEY=$_APP_STORAGE_DO_SPACES_ACCESS_KEY
      - OPR_EXECUTOR_STORAGE_DO_SPACES_SECRET=$_APP_STORAGE_DO_SPACES_SECRET
      - OPR_EXECUTOR_STORAGE_DO_SPACES_REGION=$_APP_STORAGE_DO_SPACES_REGION
      - OPR_EXECUTOR_STORAGE_DO_SPACES_BUCKET=$_APP_STORAGE_DO_SPACES_BUCKET
      - OPR_EXECUTOR_STORAGE_BACKBLAZE_ACCESS_KEY=$_APP_STORAGE_BACKBLAZE_ACCESS_KEY
      - OPR_EXECUTOR_STORAGE_BACKBLAZE_SECRET=$_APP_STORAGE_BACKBLAZE_SECRET
      - OPR_EXECUTOR_STORAGE_BACKBLAZE_REGION=$_APP_STORAGE_BACKBLAZE_REGION
      - OPR_EXECUTOR_STORAGE_BACKBLAZE_BUCKET=$_APP_STORAGE_BACKBLAZE_BUCKET
      - OPR_EXECUTOR_STORAGE_LINODE_ACCESS_KEY=$_APP_STORAGE_LINODE_ACCESS_KEY
      - OPR_EXECUTOR_STORAGE_LINODE_SECRET=$_APP_STORAGE_LINODE_SECRET
      - OPR_EXECUTOR_STORAGE_LINODE_REGION=$_APP_STORAGE_LINODE_REGION
      - OPR_EXECUTOR_STORAGE_LINODE_BUCKET=$_APP_STORAGE_LINODE_BUCKET
      - OPR_EXECUTOR_STORAGE_WASABI_ACCESS_KEY=$_APP_STORAGE_WASABI_ACCESS_KEY
      - OPR_EXECUTOR_STORAGE_WASABI_SECRET=$_APP_STORAGE_WASABI_SECRET
      - OPR_EXECUTOR_STORAGE_WASABI_REGION=$_APP_STORAGE_WASABI_REGION
      - OPR_EXECUTOR_STORAGE_WASABI_BUCKET=$_APP_STORAGE_WASABI_BUCKET

  appwrite-mariadb:
    image: mariadb:10.11
    labels:
      createdBy: "Apps"
    restart: always
    <<: *x-logging
    networks:
      - appwrite
    volumes:
      - ${APPWRITE_ROOT_PATH}/mariadb:/var/lib/mysql:rw
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD:-rootsecretpassword}
      - MYSQL_DATABASE=${_APP_DB_SCHEMA:-appwrite}
      - MYSQL_USER=${_APP_DB_USER:-user}
      - MYSQL_PASSWORD=${_APP_DB_PASS:-password}
    command: 'mysqld --innodb-flush-method=fsync'

  appwrite-redis:
    image: redis:7.2.4-alpine
    labels:
      createdBy: "Apps"
    restart: always
    <<: *x-logging
    command: >
      redis-server
      --maxmemory            512mb
      --maxmemory-policy     allkeys-lru
      --maxmemory-samples    5
    networks:
      - appwrite
    volumes:
      - ${APPWRITE_ROOT_PATH}/redis:/data:rw
